<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/x-icon" href="/assets/img/ico/red.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyncl Vault</title>
    <meta property="og:url" content="https://cyncl.nekoweb.org">    
    <meta property="og:type" content="website">
    <meta property="og:title" content="Cyncl Vault" />
    <meta property="og:description" content="Online portfolio of @Cyncl.Art" />  
    <meta property="og:image" content="/assets/img/favicon.png">
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/book.css">
    <script src="../kit.fontawesome.com/59604fa9da.js" crossorigin="anonymous"></script>
	  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="scripts/playlist.js" type="text/javascript" defer></script>
    <script src="/scripts/home-footer.js" type="text/javascript" defer></script>
    <script src="/scripts/randomizer.js" type="text/javascript" defer></script>
    <script src="/scripts/header.js" type="text/javascript" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="/scripts/booknav.js" defer></script>
    <script>
    window.addEventListener("load", () => {
      const blocks = document.querySelectorAll(".fade-block");
      
      blocks.forEach((block, i) => {
        setTimeout(() => {
          block.classList.add("visible");
        }, i * 70); // Stagger animation: 150ms between each block
      });
    });
    </script>
</head>
  <body>
    
<div id="book-modal" class="modal">
    <div class="progress-container">
  <div class="progress-bar"></div>
</div>
<div class="scene fade-block">
<!-- big book 1/Solstitheian Logbook -->
  <article class="book fade-block">
      <!-- cover intro -->  
  <section id="almanac-cover" class="page active">
    <div class="front" onclick="flipsound();">
      <div class="image-container">
        <div class="effect3"></div>
        <img src="/assets/book/almanac/front-cover.jpg" alt="Art Page" class="full-image">
        <div class="effect2"></div>
        <div class="light2"></div>
      </div>
    </div>
    <div class="back title-page" onclick="flipsound();">
            <h1 class="book-title">Solstithian Almanac</h1>
              <h2 class="book-subtitle"><i>DISCLAIMER: THIS IS NOT THE <b>REAL</b> AlMANAC, FOR THAT, PLEASE PURCHASE, A LINK IS AVAILABLE ON THE FRONT PAGE.</i></h2>
                <div class="decorative-line"></div>
                   <p class="book-author">By Biblio S.P.</p>
                  <div class="publishing-info">
             <p>Biblio • 2025</p>
        </div>  
    </div>  
  </section>
  
      <!-- Table of contents -->  
   <section id="almanac-toc" class="page">
     <!-- The Table of contents -->
    <div class="front toc" onclick="flipsound();">
       <h2 class="toc-title">Table of Contents</h2>
                    <div class="toc-entry"><a href="#almanac-pg1-2">The Pantheon of Solstitheo</a><span>1-2</span></div>
                    <div class="toc-entry"><a href="#almanac-pg3-4">The Afflictions of Baylis</a><span>3</span></div>
                    <div class="toc-entry"><a href="#almanac-pg3-4">Edelith Pods</a><span>4</span></div>
                    <div class="toc-entry"><a href="#almanac-pg5-6">Life in the Wastes</a><span>5</span></div>
                    <div class="toc-entry"><a href="#almanac-pg5-6">The Wake of Steel</a><span>6</span></div>
                    <div class="toc-entry"><a href="#almanac-pg7-8">The Great Schism</a><span>7-8</span></div>
                    <div class="decorative-line"></div>

    </div>
     <!-- The Pantheon -->
    <div class="back" onclick="flipsound();">
                    <h2 class="chapter-title2">The Pantheon of Solstitheo</h2>
                    <div class="decorative-line"></div>
                    <div class="entry-date">2/21/2025 8:39 PM</div>
                    
                    <p><span class="drop-cap">A</span>nyways, here are the complete list of the deities and their domains.</p>
                    <br>
                    <div class="illuminated">
                        <h3 class="section-title">Solidaritus</h3>
                        <p><em>The Igniting Daybreak</em><br>
                        <strong>Realized God of Destiny</strong><br>
                        Domains: Ambition, Arcana, and Life</p>
                    </div>
                    
                    <div class="illuminated">
                        <h3 class="section-title">Partirnax</h3>
                        <p><em>The Rising Dawn</em><br>
                        <strong>Enlightened God of Innovation</strong><br>
                        Domains: Forge, Knowledge, and War</p>
                    </div>

                    <span class="page-number right">1</span>
    </div>    
  </section>
    
      <!-- Page 1-2: Pantheon of Solstitheo -->  
   <section id="almanac-pg1-2" class="page">
     <!-- Page 2: Pantheon -->  
    <div class="front" onclick="flipsound();">
       <h2 class="chapter-title2">The Pantheon of Solstitheo</h2>
                    <div class="decorative-line"></div>
                    <div class="entry-date">2/21/2025 8:39 PM</div>
                    <div class="illuminated">
                        <h3 class="section-title">Annuatera</h3>
                        <p><em>The Flourishing Zenith</em><br>
                        <strong>Gloried Goddess of Fertility</strong><br>
                        Domains: Life, Nature, and Tempest</p>
                    </div>
                    
                    <div class="illuminated">
                        <h3 class="section-title">Hiebrief</h3>
                        <p><em>The Decaying Dusk</em><br>
                        <strong>Shrouded Goddess of Deceit</strong><br>
                        Domains: Shadow, Trickery, and Twilight</p>
                    </div>
                    
                    <div class="illuminated">
                        <h3 class="section-title">Totarash</h3>
                        <p><em>The Smoldering Nightfall</em><br>
                        <strong>Silenced Deity of Tranquility</strong><br>
                        Domains: Grave, Order, and Peace</p>
                    </div>
                    
                    <span class="page-number right">2</span>
                </div>
     <!-- Page 3: Baylis-->            
    <div class="back"  onclick="flipsound();">
      <h2 class="chapter-title2">Baylis The Afflicted</h2>
                    <div class="decorative-line"></div>
                    <div class="entry-date">2/21/2025 8:53 PM</div>
                    
                    <p><span class="drop-cap">B</span>aylis is afflicted by both Corrosion and Refraction. Corrosion is the disease that demons carry that deteriorates things. It infects mostly metal, degrading and contaminating it. But it is also in opposition with organic life, eating away natural substances for sustenance.</p>
                    <br>

                        <p>Refraction stems from angelic weaponry. It uses divine light to purge the Corrosion and Demonkind, eradicating most infections. However, this energy is lethal to humanity as well, severing the immortality link with the Circlet.</p>
                        <br>
                        <p>Refractory weapons were mostly used by angels in the Wake of Steel against demons but also people who sided with the enemy. Baylis, his body in a battle between Corrosion and Refraction, will die if either force is removed. If his body gives out, his soul will surely follow.</p>
                    <span class="page-number right">3</span>
    </div>    
  </section>
  
     <!-- Page 3-4: edelith pods and Life in the wastes -->  
   <section id="almanac-pg3-4" class="page">
      <!-- Page 4: Edelith pods -->  
    <div class="front" onclick="flipsound();">
 <h2 class="chapter-title2">Edelith Pods</h2>
                    <div class="decorative-line"></div>
                    <div class="entry-date">2/28/2025 9:50 PM</div>
                    
                    <p><span class="drop-cap">E</span>delith Pods are essential to the Wastes of Edelith. Originating from the Circlet of the Sun, these "seedlings" usually appear in bursts of 3-5. They were designed by the angels of the Circlet as a means to rehabilitate the desert after most fertile land was destroyed by the Wake of Steel.</p>
                    
                    <div class="illuminated">
                        <h3 class="section-title">Pod Lifecycle</h3>
                        <p>1. <strong>Dormancy:</strong> 3-6 days after landing<br>
                        2. <strong>Activation:</strong> Volatile energy surge creates oasis<br>
                        3. <strong>Growth:</strong> Months of sustainable expansion<br>
                        4. <strong>Maturity:</strong> Full desert rehabilitation</p>
                        </div>
                    
                     <p>Because of its powerful nature, no entity yet has managed to harness the Pod's power. Post-Wake-of-Steel communities cultivated the Pod after it had landed. Meanwhile, the Winds of the Wastes, uprooted any flourished Edelith Pods to swiftly procure the resources and compete with outside forces.</p>
                    
                    <div style="border-left: 3px solid #c9a66b;padding-left: 15px;margin: 20px 0;">
                            <h3 style="font-family: 'Arial'; color: #5c2c0d;">From death comes life, and from life comes death</h3>
                            <p style="font-family: 'Georgia';">such is the cycle of the Pods. Just as the Pods are used to breathe life, they are also just as adept in taking away it.</p>
                             </div>
                    <span class="page-number right">4</span>
    </div>
    <!-- Page 5: life in the wastes -->
    <div class="back" onclick="flipsound();">
       <h2 class="chapter-title2">Life in the Wastes</h2>
                        <div class="decorative-line"></div>
                        <div class="entry-date">2/28/2025 10:22 PM</div>
                        <p><span class="drop-cap">A</span>fter the Wake of Steel, those who had survived being outside the walls and foreigners still trickling in through the Shroud formed small, close-knit communities in the Wastes. Like the farmers that occupied the lands before them, many of these settlers worshipped Annuaterra and attributed the fall of the Edelith Pods to her. Other than food, life in the Wastes was optimal with the lack of prey and the nearby Obsidian Crystallis warding off larger demons.</p>
                        <br>
                        <p>An emerging community within the Wastes, <b>Tarpaul Pit</b> sought to exude a greater influence on the sands. Combining a collection of gangsters into a standing militia, the goals of the Winds of the Wastes were to control the landing sites of the Edelith Pods. With a siphoning of food and resources, Tarpaul Pit’s growth was boosted exponentially to the point where Edelith Proper had successfully set up trade routes with them.</p>
                        <br>
                        <p>The aggressive practices of the Winds of the Wastes left many smaller settlements raided and starved. With little to no power left, the raw and unformed Corrosion creeped in on them, digesting them into nothing but <b>Dust Dregs</b> clinging onto the sand. Most still hold onto their memories, but they are jumbled like the sand that gives them form. Thalor Vitric found a boy withered in the sand. He dug him out of the ruins, fed him some water, and led him back to the Obsidian Crystallis for him to grow in his early years.</p>
                        <br>
                        <p>Quietly surveying the desert for weaknesses in Tarpaul Pit, the boy became quite fond of his foster parent. Budd visits the destroyed settlement, occasionally with <b>Vitric</b> and alone. He doesn’t know why; it comes naturally to him.</p>
                        <span class="page-number right">5</span>
                </div>    
  </section>
  
     <!-- Page 5-6: Solstitheian schism -->  
  <section id="almanac-pg5-6" class="page">
      <!-- Page 6: schism p1 -->  
    <div class="front" onclick="flipsound();">
<h2 class="chapter-title2">The Wake of Steel</h2>
                    <div class="decorative-line"></div>
                    <div class="entry-date">3/8/2025 12:04 AM</div>
                    
                    <p><span class="drop-cap">W</span>hile many cite the emergence of demons from the bowels of the depths as the beginning of the Wake of Steel, the war truly didn't begin for Edelith until the first wave of demons crashed into them. A hoard of metallic monsters, armed with the most advanced weaponry known to man, were led by a red-maned horseman towards to province. Attacking early in the morning, this coalition of demons and man threatened to overwhelm Edelith entirely with flesh-craving demons.</p>
                    <br>
                    <p>The Winds of Edelith, led by <b>General Levant Strom</b>, were first to mobilize against the swarm. Clad with golden weapons immune to the Corrosion's deterioration, this army held out strongly and desperately in a small village outside of the walls. However, the demonic force quickly surrounded them, tearing these protectors of Edelith asunder. The angels of the Circlet of the Sun, seeing no other possibility, launched radiant crystals from the heavens, erradicating thousands in the battle. Both man and demon were dead and the Obsidian Crystallis still holds the ruins of the village that once stood there deep underneath the black glass sands.</p>
                    <br>
                    <p><b>Vitric</b> was locked in combat with a soldier of the Winds of Edelith. Gaining the upper hand, he slashed his side and prepared to deliver a decisive blow with his sickly blade. Then, suddenly, a brilliant light appeared in the sky and crashed down to the earth in a blaze. Crystal shards lay thick in the air and, in a clearing, a large man with golden armor lay hunched over this puny soldier. Unmoving, General Levant Strom loomed over the boy with his shield raised high, protecting him from the blast. The bloodied grunt slipped away, tearing off the bejeweled coat of his leader; medals of honor, glory, and triumph. As darkness closed in around Vitric and crystals grew from the wounds in his skin, his last thoughts were hatred and fear.</p>
                    <br>
                    
                    <span class="page-number right">6</span>
    </div>
    <!-- Page 7: schism p2 -->
    <div class="back" onclick="flipsound();">
        <h2 class="chapter-title2">Great Solstitheian Schism</h2>
                    <div class="decorative-line"></div>
                    <div class="entry-date">3/14/2025 11:46 PM</div>
                    
                    <p><span class="drop-cap">I</span>nitially, the people of Solstitheo accepted each god. It was agreed that each one offered their own path to salvation, their own method to the same transcendence. This resulted in the formation of a mixed pantheon of deities. You could find each citizen resonating to their own deity and, in many circumstances, even the reverence of an array of gods. All gods were regarded as equal in their power, no domain could overpower the other.</p>
                    <br>
                    <p>Some say it was the commonfolk drawing their faith into simple squabbles. Others, the fated failures of these mixed religions. But, the most promising theory for where the violence stemmed from were the prophets. Starting with simple tasks, preachings and condemnations, priests and other holy men garnered more followers to their places of worship. Then, the tasks grew more extreme; slander, theft, denunciations, violence, murder...</p>
                    <p style="font-style: italic; margin-bottom: 30px;">Each church spiraled out of control</p>
                    <p>They retaliated against one another in increasingly brutalizing fashions. <b>The clergy's excuse?</b> They held accountability to the whispers of their god, swaying them to blindly carry out these acts of cruelty. These microaggressions and acts of hate eventually spiraled out of control into what would be understood as <b><u>the Great Solstitheian Schism</u></b> when riots and brawls erupted in the capital. Citizens quickly dispersed themselves, forming under factions of their faith in fears for their safety. Cities destabilized into chaos as the military struggled to stifle the infighting; their own ranks weren't spared from the fury.</p>
                    <br>
                    
                    <span class="page-number right">7</span>
    </div>
  </section>
  
     <!-- Page 7-8: closing notes -->  
   <section id="almanac-pg7-8" class="page">
      <!-- Page 7: schism -->
    <div class="front" onclick="flipsound();">
        <h2 class="chapter-title2" style="top: -40px">Great Solstitheian Schism</h2>
                    <div class="decorative-line"></div>
                    <div class="entry-date">3/14/2025 11:46 PM</div>
                    <p>The countryside witnessed the burning and slaughter of <b>Annuatera</b>-alligned hamlets by <b>Partinax</b> militias, the famines and disease striking isolated provinces of the empire by Annuaterra bioterrorists, and the kidnapping of innocent men, women, children by <b>Solidaritus</b> cultists to either be purged or experiemented on. Within Edelith's walls, <b>Totarash</b> banners hung high and imperial enchanters silently brainwashed those still holding on to their innocence, circus festivities performed for the on-edge and bickering nobility were interrupted with coordinated slaughters <b>by Hiebrief</b> assassins, and mobs took to the streets to vandalize and capture religious offenders like a witch hunt.</p>
                    <br>
                    <p>This sporattic fighting defined a solemn few years of Edelith's history. Many lost sight on who they were fighting; friends, lovers, comrades, family. They lost sight what they were fighting for, only viewing the conflicts as a means for survival and superiority. Eventually the fighting would have to diminish. It was too sudden, in fact. When a weakened Edelith just emerged from the ashes of civil war, so too did something else. Metallic and smelling of bile, it was the events of the Great Solstitheian Schism that allowed the Wake of Steel to be so devastating.</p>
                    <span class="page-number right">8</span>
                </div>
      <!-- Page 8: cover back -->          
    <div class="back" onclick="flipsound();">
      <div class="image-container">
        <div class="effect-cover2"></div>
        <img src="/assets/book/almanac/back-cover.jpg" alt="Art Page" class="full-image">
        <div class="effect-cover1"></div>
        <div class="light-cover"></div>
      </div>
    </div>
  </section>
  
  <!-- phantom -->
  <section id="almanac-back-cover" class="page" style="opacity: 0.0;">
  <!-- Invisible front side -->
  <div class="front" style="visibility: hidden; opacity: 0.0;"></div>
  
  <!-- Invisible back side -->
  <div class="back" style="visibility: hidden; opacity: 0.0;"></div>
</section>

</article>
</div>
</div>
<side-bar-nav class=fade-block></side-bar-nav>
<!-- page-flip sounds.js -->
<script>
  const flipping = [
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-01a.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-02.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-03.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-4.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-5.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-6.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-7.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-8.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-9.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-10.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-12.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-16.mp3",
  "https://file.garden/aE4BmvQeoiKwc59V/page%20flips/page-flip-19.mp3",
  ];
  				
  function flipsound() {
  const randomIndex = Math.floor(Math.random() * flipping.length);
  const audio = new Audio(flipping[randomIndex]);
  audio.volume = 0.45;
  audio.play();
}
</script>

<!-- book-core.js -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  let currentPage = 0;
  let totalPages = document.querySelectorAll('.page').length;
  let isAnimating = false;
  let normalSpeed = 300;
  let fastSpeed = 100;
  let currentSpeed = normalSpeed;
  let speedTimeout;
  let scrollTimeout;
  let clickCount = 0;
  let clickTimeout;

  const pageHashes = [
    'almanac-cover',
    'almanac-toc',
    'almanac-pg1-2',
    'almanac-pg3-4',
    'almanac-pg5-6',
    'almanac-pg7-8',
    'almanac-back-cover'
  ];

  window.Book = {
    get currentPage() { return currentPage },
    get totalPages() { return totalPages },
    get isAnimating() { return isAnimating },
    get pageHashes() { return pageHashes },

    setPage(n) { currentPage = n },
    setAnimating(state) { isAnimating = state },
    setSpeed(speed) { currentSpeed = speed },
    resetSpeed() { currentSpeed = normalSpeed },
    getSpeed() { return currentSpeed },

    getElements() {
      return {
        scene: document.querySelector('.scene'),
        modal: document.getElementById("book-modal"),
        progressBar: document.querySelector('.progress-bar'),
        pages: document.querySelectorAll('.page')
      }
    }
  }
});
</script>

<!-- book-navigation.js -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const { setPage, setAnimating, isAnimating, pageHashes } = window.Book;

  function updateProgressBar() {
    const { progressBar } = Book.getElements();
    const percent = (Book.currentPage / (Book.totalPages - 1)) * 100;
    progressBar.style.width = percent + '%';
  }

  function updateURLHash() {
    if (Book.currentPage >= 0 && Book.currentPage < pageHashes.length) {
      history.replaceState(null, null, '#' + pageHashes[Book.currentPage]);
    }
  }

  function updateBookPosition() {
    const { scene } = Book.getElements();
    const isLastPage = Book.currentPage === Book.totalPages - 1;
    const isCover = Book.currentPage === 0;
    
    if (isCover) {
      scene.style.left = '0';
      scene.classList.remove('opened', 'last-page');
    } else if (isLastPage) {
      scene.style.left = '46%'; // Double the normal offset
      scene.classList.add('opened', 'last-page');
    } else {
      scene.style.left = '23%'; // Normal opened position
      scene.classList.add('opened');
      scene.classList.remove('last-page');
    }
  }

  function nextPage() {
    if (isAnimating || Book.currentPage >= Book.totalPages - 1) return;
    setAnimating(true);

    const { pages, scene } = Book.getElements();
    const activePage = document.querySelector('.active');
    activePage.classList.remove('active');
    activePage.classList.add('flipped');

    const nextPage = activePage.nextElementSibling;
    if (nextPage && nextPage.classList.contains('page')) {
      nextPage.classList.add('active');
      setPage(Book.currentPage + 1);
    }

    updateProgressBar();
    updateURLHash();
    updateBookPosition();
    setTimeout(() => setAnimating(false), Book.getSpeed());
  }

  function prevPage() {
    if (isAnimating) return;
    setAnimating(true);

    const flippedPages = document.querySelectorAll('.flipped');
    if (flippedPages.length > 0) {
      const lastFlipped = flippedPages[flippedPages.length - 1];
      lastFlipped.classList.remove('flipped');
      lastFlipped.classList.add('active');

      document.querySelectorAll('.page').forEach(p => {
        if (p !== lastFlipped) p.classList.remove('active');
      });

      setPage(Book.currentPage - 1);
    }

    updateProgressBar();
    updateURLHash();
    updateBookPosition();
    setTimeout(() => setAnimating(false), Book.getSpeed());
  }

  function navigateToPage(targetPage) {
    if (targetPage < 0 || targetPage >= Book.totalPages || isAnimating) return;
    const flipDirection = targetPage > Book.currentPage ? nextPage : prevPage;
    const steps = Math.abs(targetPage - Book.currentPage);
    const flip = () => {
      if (Book.currentPage !== targetPage && !isAnimating) {
        flipDirection();
        setTimeout(flip, Book.getSpeed() + 20);
      }
    };
    flip();
    updateBookPosition();
  }

  window.BookNav = { nextPage, prevPage, navigateToPage, updateProgressBar, updateURLHash, updateBookPosition };
});
</script>

<!-- book-ui.js -->
<script>
// book-ui.js
document.addEventListener('DOMContentLoaded', function () {
  // Wait for BookUI to be initialized
  setTimeout(() => {
    const { openBookModal } = window.BookUI;

    document.querySelectorAll(".preview").forEach(preview => {
      preview.addEventListener("click", (e) => {
        e.preventDefault();
        openBookModal();
        BookNav.navigateToPage(0);
        BookNav.updateURLHash();
      });
    });

    document.getElementById("book-modal").addEventListener("click", e => {
      if (!e.target.closest('.scene') && !e.target.closest('.progress-container')) {
        window.BookUI.closeBookModal();
      }
    });

    document.querySelector('.progress-container').addEventListener('click', function (e) {
      if (Book.isAnimating) return;
      const rect = this.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const percent = clickX / rect.width;
      const page = Math.round(percent * (Book.totalPages - 1));
      BookNav.navigateToPage(page);
    });
  }, 100);
});
</script>

<!-- book-ui-modal.js -->
<script>
// book-ui-modal.js
document.addEventListener('DOMContentLoaded', function () {
  let scrollPosition = 0;
  let isModalOpen = false;

  function openBookModal() {
    const { modal, scene } = Book.getElements();
    if (!modal.classList.contains("show")) {
      // Save current scroll position
      scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
      isModalOpen = true;
      
      modal.classList.add("show");
      document.body.classList.add("modal-open");
      scene.classList.remove('opened');
      
      // Prevent scrolling
      document.body.style.position = 'fixed';
      document.body.style.width = '100%';
      document.body.style.top = `-${scrollPosition}px`;
    }
  }

  function closeBookModal() {
    const { modal, scene } = Book.getElements();
    if (modal.classList.contains("show")) {
      // Clear hash first
      history.replaceState(null, null, ' ');
      modal.classList.remove("show");
      document.body.classList.remove("modal-open");
      resetBookState();
      
      // Restore scrolling and scroll position
      const scrollY = document.body.style.top;
      document.body.style.position = '';
      document.body.style.width = '';
      document.body.style.top = '';
      
      if (isModalOpen) {
        window.scrollTo(0, parseInt(scrollY || '0') * -1);
      }
      isModalOpen = false;
    }
  }

  function resetBookState() {
    const { pages, scene } = Book.getElements();
    Book.setPage(0);
    pages.forEach((p, i) => {
      p.classList.remove('active', 'flipped');
      if (i === 0) p.classList.add('active');
    });
    scene.classList.remove('opened');
    BookNav.updateProgressBar();
  }

  // Initialize BookUI immediately
  window.BookUI = { openBookModal, closeBookModal };
});
</script>

<!-- book-events.js -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const bookElement = document.querySelector('.book');

bookElement.addEventListener('wheel', function (e) {
  if (Book.isAnimating) return;
  
  // Play flip sound when wheel action would cause a page turn
  if ((e.deltaY > 0 && Book.currentPage < Book.totalPages - 1) || 
      (e.deltaY < 0 && Book.currentPage > 0)) {
    flipsound();
  }

  if (Math.abs(e.deltaY) > 15) Book.setSpeed(100);
  if (e.deltaY > 0 && Book.currentPage < Book.totalPages - 1) {
    BookNav.nextPage();
  } else if (e.deltaY < 0 && Book.currentPage > 0) {
    BookNav.prevPage();
  }
  clearTimeout(window.scrollTimeout);
  window.scrollTimeout = setTimeout(() => Book.resetSpeed(), 300);
});

  document.querySelectorAll('.page').forEach(page => {
    page.addEventListener('click', function () {
      if (Book.isAnimating) return;
      if (this.classList.contains('active')) {
        BookNav.nextPage();
      } else {
        BookNav.prevPage();
      }
    });
  });

  const hammertime = new Hammer(bookElement);
  hammertime.on("swipeleft", BookNav.nextPage);
  hammertime.on("swiperight", BookNav.prevPage);

  // Initial hash and hashchange
  const hash = window.location.hash.substring(1);
  const pageIndex = Book.pageHashes.indexOf(hash);
  if (pageIndex !== -1) {
    window.BookUI.openBookModal();
    BookNav.navigateToPage(pageIndex);
  }

  window.addEventListener('hashchange', function () {
    const hash = window.location.hash.substring(1);
    const idx = Book.pageHashes.indexOf(hash);
    if (idx !== -1 && idx !== Book.currentPage) {
      window.BookUI.openBookModal();
      BookNav.navigateToPage(idx);
    } else if (!hash) {
      window.BookUI.closeBookModal();
    }
  });
});
</script>

</body>
</html>
